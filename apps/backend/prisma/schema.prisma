// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String     @id @default(uuid()) @db.Uuid
  createdAt DateTime   @default(now()) @db.Timestamptz(3)
  updatedAt DateTime   @updatedAt @db.Timestamptz(3)
  email     String     @unique @db.VarChar(255)
  role      String     @db.VarChar(255)
  password  String     @db.VarChar(255)
  userGames UserGame[]
}

model Game {
  id           String     @id @default(uuid()) @db.Uuid
  sportKey     String     @db.VarChar(255)
  sportTitle   String     @db.VarChar(255)
  commenceTime DateTime   @db.Timestamptz(3)
  homeTeam     String     @db.VarChar(255)
  awayTeam     String     @db.VarChar(255)
  bankroll     Decimal    @db.Decimal(10,2)
  timeOdds     TimeOdds[]
  userGames    UserGame[]
}

model TimeOdds {
  id          String   @id @default(uuid()) @db.Uuid
  game        Game     @relation(fields: [gameId], references: [id])
  gameId      String   @db.Uuid
  time        DateTime @db.Timestamptz(3)
  homePrice   Decimal  @db.Decimal(10,2)
  awayPrice   Decimal  @db.Decimal(10,2)
  homeWinProb Decimal  @db.Decimal(10,2)
  awayWinProb Decimal  @db.Decimal(10,2)
}

model UserGame {
  id            String          @id @default(uuid()) @db.Uuid
  user          User            @relation(fields: [userId], references: [id])
  userId        String          @db.Uuid
  game          Game            @relation(fields: [gameId], references: [id]) 
  gameId        String          @db.Uuid
  createdAt     DateTime        @default(now()) @db.Timestamptz(3)
  updatedAt     DateTime        @updatedAt @db.Timestamptz(3)
  userGameTrades UserGameTrade[]

  @@unique([userId, gameId])
}

model UserGameTrade {
  id         String   @id @default(uuid()) @db.Uuid
  userGame   UserGame @relation(fields: [userGameId], references: [id])
  userGameId String   @db.Uuid
  type       String   @db.VarChar(255)
  team       String   @db.VarChar(255)
  amount     Decimal  @db.Decimal(10,2)
  price      Decimal  @db.Decimal(10,2)
  createdAt  DateTime @default(now()) @db.Timestamptz(3)
  updatedAt  DateTime @updatedAt @db.Timestamptz(3)
}
